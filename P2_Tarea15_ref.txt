Рефлексия к заданию 14.

1.	История торговли цивилизации 
Временная таблица civilization_trade_history.
 Извлекаются все потенциально интересные данные из таблиц Caravans, trade_transactions, 
 caravan_goods путем несложных вычислений и извлечений.
 - trade_year- год коммерческий (опираясь на arrival_date)
 - caravan_count - число караванов
 - total_trade_value – объем торговли - 
 - import_value, export value 
 - unique_goods_traded – уникальные товары для торговли через Distinct – не повторяющиеся,
 значит – уникальные unique
 - unique_import, unique_export – уникальные экспортируемые и импортируемые

2.	Зависимость от ресурсов крепости. 
Временная таблица Fortress_resource_dependency.

Данные из таблиц caravan_goods, caravans. Зависимость связана с импортом. Свойство import 
достигается условием cg.type = “Import”.
Вычисляется:
       - times_imported - число импортированых товаров  (cg.goods_id)
-	total_import_value -  весь объем торговли 
-	caravans_importing – число караванов и импортируемыми товарами (cg.caravan_id)
-	avg_price_fluctuation –  средние колебания цен
-	dependency_score – показатель зависимости – отношение числа товаров к числу цивилизаций, импортиирующих товары

3.	Корреляция между торговлей и дипломатическими отношениями
Временная таблица Diplomatic_trade_correlation
Данные из таблицы diplomatic_events de, trade_transactions tt.
Вычисляется:
 - diplomatic_events – число событий
 - positive_events, negative_events – исход событий
 - total_trade_value – объем торговли
 - trade_diplomacy_correlation – корреляция между de.relationship_change и tt.value

4.	 Временная таблица workshop_export_effectiveness
Данные из таблиц product_type p, caravan_goods cg.
Таблица workshop_type.- только для связки р и cg.
Экспорт вычисляется условием cg.type = 'Export'.
Вычисляется: 
 - products_created количество созданных продуктов, как подсчет p.product_id (относится к мастерской
- products_exported – число экспортируемых продуктов, подсчетом p.product_id, где cg.goods_id не Null.
- total_production_value  - из p
- export_value как сумма cg.value
 - avg_export_markup – отношение товаров продуктов к объему продуктов

5.	Временная таблица trade_timeline
Данные из таблиц caravans c, trade_transactions tt
-	quarterly_trade_value – сумма всех транзакций из tt
trading_civilizations – число разных цивилизаций(c.civilization_type)
 - previous_quarter_value подсчет суммы объема продаж для дат c.arrival_date текущего года и квартала 
 (с помощью функции LAG)

Основная таблица.
Сначала определяются общие поля.

Затем создается большой объект Json который внутри содержит массив небольших объектов Json (также с массивами) 
что в итоге дает описание набора сущностей связанных одной темой.
Массив маленьких Json объектов, создаются функцией Select JSON_ARRAYAGG (Json_Object(набор полей и вычисление их значений))
В первом блоке  civilization_data используются данные извременных таблиц, связанных с описанием торговли
и дипломатических отношений civilization_trade_history cth , diplomatic_trade_correlation dtc
Во втором блоке critical_import_dependencies используются данные из оценки зависимости от импорта
из временной таблицы  fortress_resource_dependency frd

Третий блок – анализ экспорта товаров. Данные из временной таблицы workshop_export_effectiveness wee. 
Здесь оцениваются данные по производимым продуктам, часть экспортируемых товаров
 - Четвертый блок – анализ роста торговли
Оценка объема торговли за предыдущий и текущий квартал и вычисление разницы.


Далее в ответе  вычисляются дополнительные оценки состояния торговрли:
 Влияние торговли на экономику крепости , рекомендации, основанные на анализе торговли




Мои ошибки:
Самые главные ошибки – неправильно организовала результирующую таблицу. Совершенно не те методы.
Не поняла значение некоторых полей. 
Не использовала функцию сравнения значений строк по заданным условиям внутри таблицы Lag


 - Не использовала Case- When- Then  конструкцию, хотя она вполне уместна для выборки из столбца по условию , 
 пыталась делать через ON – что усложняет конструкцию выборки значительно
 - Не догадалась, что таблица caravan_goods связана с крепостью и описывает в общем то ее параметры. 
 В таблице есть поле fortress_id
- Не поняла что такое dependency_score
И почему вычисляется как отношение числа товаров к числу цивилизаций, оторые импортирую товары
Неправильно поняла avg_export_markup,отношение экспорта к общему числу товаров, отсюда совсем не то в вычислениях
- Поле trade_diversity определила совсем неправильно. Не поняла, что это набор разных цивилизаций.
 -Забыла ввести точность ROUND при вычислении полей с делением
- trade_relationship- вообще не сделала. Не поняла. 
А это разница импорта и экспорта.


