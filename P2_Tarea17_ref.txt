1.	Временная таблица creature_attack_history  - история атак
Ссбор данных из таблиц 
creature_attacks са, creatures с,  locations l –полей, характеризующих атаки существ в одну  результирующую таблицу. Из вычислений – только извлечение года и месяца из поля data таблицы  creature_attacks са.

2.	Временная таблица defense_structure_effectiveness -эффективност защиты
Сбор данных из таблиц defense_structures ds,   locations l, относящихся к системе защиты: тип защиты, расположение, зона, вычисление числа отраженных атак (основываясь на значение поля ca.outcome). А также даты построения защиты, обслуживания

3.	Временная таблица zone_vulnerability зона неуязвимости
Данные из таблицы location – удаленность зоны, уровень фортификации, точки доступа, тип зоны.
Из таблиц creature_attacks ca – данные об атаках - 
подсчет числа всех атак, число отраженных атак, число жертв за атаку, 
defense_structures ds - число защитных сооружений,
squad_movement sm - число патрулирующих отрядов, минимальное время ответа на атаку.
military_stations ms – зона покрытия

4.	Временная таблица  seasonal_attack_patterns сезонные схемы атак
Вычисление года, месяца, сезона, атак, число атак, числа жертв противника(существ), числа существ - из таблицы creature_attacks ca.
Вычисление среднего уровня угроз – из creatures с
Расчет средней эффективности защиты – как среднее из отраженных, пораженных и частично пораженных исходов атак с коэффициентами 1, 0 и 0.5.
Вытаскивание данных о погоде, осадках, температуре из таблицы wheather w, и фазы Луны из таблицы moon_phases mp.

5.	Временная таблица military_readiness – военная готовность.
Данные из таблиц military_stations ms, military_squads s – тип зоны, тип станции, уровень оповещения, оценка готовности.
А также  - число бойцов из squad_members sm
Уровень навыков бойцов из dwarf_skills ds
Качество экипировки из таблицы equipment eq
Даты последней тренировки, время ответа на угрозу из military_stations ms


Основная таблица:
Подсчет :
- всех атак существ , 
- числа существ
- число погибших существ
- расчет оценки успешности защиты  как отношение успешных исходов к общему числу столкновений с существами.

Построение JSON_OBJECT 'threat_assessment'

Подчиненные объекты JSON_OBJECT  
- 'current_threat_level'
Подсчет числа атак до текущей даты и присвоение в зависимости от их числа характеристики ‘Critical’, ‘Hight’. ‘Moderate’.	
Вычисление набора активных угроз с помощью массива JSON_ARRAYAGG объектов JSON_OBJECT с набором свойств из таблиц creatures c, creature_sightings cs, creature_territories ct. 
Создание массива  активных существ.

- ‘seasonal_risk_factors’ c сезонными характеристиками.


- ‘vulnerability_analysis’   
 Создание Массива JSON_ARRAYAGG объектов JSON_OBJECT:
Описание зон, 
Оценка уязвимостей в зависимости от уровня фортификаций, разрушений, времени ответа на угрозу, структуры защиты, отрядов патрулирования.
Нарушения
Уровни фортификаций
Времена реакции на угрозы
Объект JSON_OBJECT  'structure_ids', содержащий массив JSON_ARRAYAGG
Идентификаторов структур и отрядов.

´defense_effectiveness’
Создание массива JSON_ARRAYAGG объектов JSON_OBJECT, описывающих защиту крепости: тип, эффективность, потери врагов, средний уровень качества, а также массив идентификаторов структур из таблицы х , созданной здесь же (вспомогательная таблица, созданная в месте ее применения)


military_readiness_assessment'
Создание массива JSON_ARRAYAGG объектов JSON_OBJECТ 
,Поля тобъекта json взяты из временной таблицы military_readiness mr
расчет поля эффективности военная combat_effectiveness основан на временных характеристиках тренировок, навыкоа гномов, удачных защит.
´station_location'  - как JSON_OBCECT, собирающий в себе зарактеристики зоны, идентификатор, тип, имя
‘response_coverage’ – массив объектов зона – время ответа
Из таблицы military_coverage_zones mcz.

'security_evolution' 
Создание массива объектов временных характеристик боевой готовности, числа атак, потери, развитие.

recommendation_summary Суммарные рекомендации
Создание массива объектов 
Данные взяты из временной таблицы security_recommendations r, zone_vulnerability zv, military_readiness mr, defense_structures ds.


Замечания:
Интересный прием - создание таблиц i,x в ходе посороения основного запроса

Не все таблицы есть в задании, пришлось додумывать
Некоторые методика расчета не совсем понятны..
FROM (SELECT 1) AS dummy - пока не поняла что это.
